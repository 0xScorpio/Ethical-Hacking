#!/bin/bash

# Ensure the script is run with bash
if [ -z "$BASH_VERSION" ]; then
    echo "Please run this script with bash"
    exit 1
fi

# Define output function
enum() {
    echo -e "\n########### $1 #################"
    shift
    eval "$@"
}

# User & Group Info
enum "Current User ID" "id"
enum "Current User" "whoami"
enum "Sudo Permissions" "sudo -l 2>/dev/null || echo 'No sudo access'"
enum "Users in current system" "cat /etc/passwd"
enum "Shadow file check" "cat /etc/shadow"
enum "Current groups" "cat /etc/group"
enum "Current user history" "history"
enum "Logged-in Users" "w"

# Networking
enum "Network Interfaces" "ip a"
enum "IP Routes" "ip route"
enum "Open Ports" "ss -tulnp"
enum "Firewall Rules" "iptables -L -n"
enum "Firewalled Internal Ports" "netstat -tanup | grep -i listen"

# System Info
enum "Check for unusual environment variables" "env"
enum "System Information" "uname -a"
enum "Hostname" "hostname"
enum "Hostname details" "hostnamectl"
enum "Proc Version" "cat /proc/version"
enum "Issue file" "cat /etc/issue"
enum "OS Release" "cat /etc/os-release"
enum "Architecture Check (for kernel exploits)" "lscpu"
enum "Uptime" "uptime"

# Service Enumeration
enum "Running processes" "ps aux"
enum "Status of all services" "service --status-all"
enum "List active services only" "systemctl list-units --type=service --state=running --no-pager"
enum "Filesystem Table" "cat /etc/fstab"
enum "Mounted Filesystems" "mount"
enum "Writable unit system files" "systemctl list-units --state=running --type=service | grep '\.service' | awk -v FS=' ' '{print $1}' | xargs -I % systemctl status % | grep 'Loaded:' | cut -d '(' -f 2 | cut -d ';' -f 1 | xargs -I % find % -writable 2>/dev/null"

# Writable files and directories
enum "Writable directories for current user" "find / -writable -type d 2>/dev/null"
enum "Writable files for current user" "find / -type f \( -user $(whoami) -o -group $(whoami) \) -exec ls -l {} \; 2>/dev/null"


# Filesystem & SUID Binaries
enum "SUID Binaries" "find / -perm -4000 -type f 2>/dev/null"
enum "Writable Folders" "find / -writable -type d 2>/dev/null"
enum "SSH Keys Hunting" "find / -type f \( -name authorized_keys -o -name id_rsa -o -name .bash_history -o -name .ssh/config \) 2>/dev/null"
enum "Password Hunting" "grep -rE 'password|passwd|PWD' /etc 2>/dev/null"

# Installed Software & Services
enum "Installed Packages" "dpkg -l 2>/dev/null --no-pager || rpm -qa 2>/dev/null --no-pager"
enum "Possible AV Detection" "ps aux | grep -Ei 'avast|clamav|sophos|bitdefender|mcafee|kaspersky' 2>/dev/null"

# Cron Jobs
enum "Current user cron job" "crontab -l"
enum "Cron Jobs" "cat /etc/crontab 2>/dev/null; cat /etc/cron.* 2>/dev/null; cat /var/spool/cron/crontabs/* 2>/dev/null"

# Kernel & Exploits
enum "Kernel Version" "uname -r"
enum "Search for Exploits" "curl -s https://raw.githubusercontent.com/carlospolop/PEASS-ng/master/linPEAS/exploits/exploitsDB.csv | grep $(uname -r)"

# Environment Variables
enum "Environment Variables" "env"
enum "Path Variables" "echo \"\$PATH\""

echo -e "\nEnumeration complete."

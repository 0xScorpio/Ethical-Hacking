#!/bin/bash

print_section() {
    echo "------------------------------"
    echo -e "===== $1 ====="
    echo "------------------------------"
}

run_cmd() {
    echo -e "$:~ $1 \n"
    eval "$1" 2>/dev/null
    echo -e "\n<-------------------------->\n"
    read -p ">>>" dummy
    echo
}

# USER ENUMERATION
print_section "USER ENUMERATION"
run_cmd "id"
run_cmd "whoami"
run_cmd "sudo -n -l --no-pager || echo '[-] sudo -l failed (password required or not allowed)'"
run_cmd "cat /etc/passwd"
run_cmd "cat /etc/shadow"
run_cmd "cat /etc/group"
run_cmd "history"
run_cmd "getent passwd | grep '/home'"
run_cmd "find /home -type f -name '.bash_history' -exec cat {} +"

# SYSTEM ENUMERATION
print_section "SYSTEM ENUMERATION"
run_cmd "hostname"
run_cmd "uname -a"
run_cmd "cat /etc/os-release"
run_cmd "cat /etc/issue"
run_cmd "cat /proc/version"
run_cmd "lscpu"

# NETWORK ENUMERATION
print_section "NETWORK ENUMERATION"
run_cmd "ip a"
run_cmd "ip r"
run_cmd "ss -tulpn | grep -in listen"
run_cmd "netstat -antup | grep -in listen"
run_cmd "cat /etc/resolv.conf"
run_cmd "cat /etc/hosts"
run_cmd "arp -a"
run_cmd "iptables -L -n"

# SUID / SGID FILES
print_section "SUID / SGID ENUMERATION"
run_cmd "find / -type f -perm -u=s 2>/dev/null | grep -v snap"
run_cmd "find / -perm -2000 -type f 2>/dev/null"

# CRON JOBS
print_section "CRON JOB ENUMERATION"
run_cmd "crontab -l"
run_cmd "ls -lah /etc/cron* 2>/dev/null"
run_cmd "cat /var/spool/cron/crontabs/* 2>/dev/null"

# ENV VARIABLES
print_section "ENVIRONMENT VARIABLES"
run_cmd "env"

# FILE CAPABILITIES
print_section "FILE CAPABILITIES"
run_cmd "getcap -r / 2>/dev/null | GREP_COLOR='1;31' grep --color=always -E 'cap_(sys|dac|setuid|fowner|ptrace|chroot)|$'"

# SERVICES
print_section "SERVICE ENUMERATION"
run_cmd "systemctl list-units --type=service --state=running"
run_cmd "service --status-all 2>/dev/null"
run_cmd "dpkg -l --no-pager"
run_cmd "lsmod"

# PASSWORD HUNTING
print_section "PASSWORD HUNTING"
run_cmd "find / -name id_rsa 2>/dev/null"
run_cmd "find / -name authorized_keys 2>/dev/null"
run_cmd "find /home /opt/ /var /etc \( -iname '*.conf' -o -iname '*.php' -o -iname '*.bak' -o -iname '*.ini' -o -iname '*.env' -o -iname '*.json' -o -iname '*.xml' -o -iname '*.log' \) -type f -exec grep -HEni --color=always 'pass(word)?' {} \; 2>/dev/null"
run_cmd "grep -rEni --color=always 'pass(word)?' /home /opt /var /etc 2>/dev/null"
